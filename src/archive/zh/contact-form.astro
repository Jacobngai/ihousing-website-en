---
import Layout from '@/layouts/Layout.astro';

const title = 'è”ç³»iHousing | è·å–å…è´¹å’¨è¯¢';
const description = 'è”ç³»iHousingäº†è§£é©¬å…­ç”²Airbnbç‰©ä¸šç®¡ç†ã€‚å¡«å†™è¡¨æ ¼ï¼Œæˆ‘ä»¬å°†åœ¨24å°æ—¶å†…é€šè¿‡WhatsAppå›å¤æ‚¨ã€‚';
const image = 'https://images.unsplash.com/photo-1560448204-e02f11c3d0e2?w=1200';

// WhatsApp number (hidden from public view, used only for redirect)
const whatsappNumber = '60196996688';

// Get referrer URL for context
let referrer = Astro.url.href;
let referrerTitle = 'è”ç³»è¡¨æ ¼';

// Try to extract context from referrer
if (Astro.request.headers.get('referer')) {
  referrer = Astro.request.headers.get('referer') || referrer;
}

// Determine page context from URL
const url = new URL(Astro.url.href);
const utmSource = url.searchParams.get('utm_source') || '';
const utmCampaign = url.searchParams.get('utm_campaign') || '';
const property = url.searchParams.get('property') || '';
const interest = url.searchParams.get('interest') || '';
---

<Layout title={title} description={description} image={image}>
  <main>
    <!-- Hero Section -->
    <section class="relative bg-gradient-to-br from-green-900 via-green-800 to-emerald-900 text-white py-16 lg:py-20">
      <div class="absolute inset-0 bg-black/30"></div>
      <div class="relative max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 text-center">
        <p class="text-green-300 font-semibold mb-4 text-lg">è”ç³»æˆ‘ä»¬</p>
        <h1 class="text-3xl lg:text-4xl font-bold leading-tight mb-6">
          è®©æˆ‘ä»¬èŠèŠæ‚¨çš„æˆ¿äº§
        </h1>
        <p class="text-xl text-green-100 mb-4">
          å¡«å†™ä¸‹é¢çš„è¡¨æ ¼ï¼Œæˆ‘ä»¬å°†åœ¨24å°æ—¶å†…é€šè¿‡WhatsAppå›å¤æ‚¨ã€‚
        </p>
        <p class="text-green-200 text-sm">
          å…è´¹å’¨è¯¢ â€¢ æ— ä¹‰åŠ¡ â€¢ ä¸“å®¶å»ºè®®
        </p>
      </div>
    </section>

    <!-- Contact Form -->
    <section class="py-16 bg-white">
      <div class="max-w-2xl mx-auto px-4 sm:px-6 lg:px-8">
        <div class="bg-gray-50 p-8 rounded-2xl shadow-lg">
          <h2 class="text-2xl font-bold text-gray-900 mb-6 text-center">
            ç»™æˆ‘ä»¬å‘é€æ¶ˆæ¯
          </h2>
          <p class="text-gray-600 mb-8 text-center">
            æˆ‘ä»¬å°†åœ¨24å°æ—¶å†…é€šè¿‡WhatsAppå›å¤æ‚¨ï¼Œæä¾›ä¸ªæ€§åŒ–ä¿¡æ¯ã€‚
          </p>

          <form id="contact-form" class="space-y-5">
            <!-- Name -->
            <div>
              <label for="name" class="block text-sm font-semibold text-gray-700 mb-2">
                æ‚¨çš„å§“å *
              </label>
              <input
                type="text"
                id="name"
                name="name"
                required
                class="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:border-green-500 focus:outline-none transition-colors"
                placeholder="ä¾‹å¦‚ï¼šAhmad"
              />
            </div>

            <!-- Phone Number -->
            <div>
              <label for="phone" class="block text-sm font-semibold text-gray-700 mb-2">
                æ‰‹æœºå·ç ï¼ˆWhatsAppï¼‰*
              </label>
              <input
                type="tel"
                id="phone"
                name="phone"
                required
                class="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:border-green-500 focus:outline-none transition-colors"
                placeholder="ä¾‹å¦‚ï¼š012-345 6789"
              />
              <p class="text-sm text-gray-500 mt-1">
                æˆ‘ä»¬å°†é€šè¿‡æ­¤å·ç WhatsAppè”ç³»æ‚¨
              </p>
            </div>

            <!-- Email (Optional) -->
            <div>
              <label for="email" class="block text-sm font-semibold text-gray-700 mb-2">
                ç”µå­é‚®ç®±ï¼ˆå¯é€‰ï¼‰
              </label>
              <input
                type="email"
                id="email"
                name="email"
                class="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:border-green-500 focus:outline-none transition-colors"
                placeholder="ä¾‹å¦‚ï¼šahmad@email.com"
              />
            </div>

            <!-- Property Location -->
            <div>
              <label for="property" class="block text-sm font-semibold text-gray-700 mb-2">
                æˆ¿äº§ä½ç½®
              </label>
              <select
                id="property"
                name="property"
                class="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:border-green-500 focus:outline-none transition-colors"
              >
                <option value="">é€‰æ‹©æ‚¨çš„æˆ¿äº§</option>
                <option value="Parkland Avenue">Parkland Avenue</option>
                <option value="Silverscape Residence">Silverscape Residence</option>
                <option value="The Shore Residence">The Shore Residence</option>
                <option value="Imperio Residence">Imperio Residence</option>
                <option value="Novo 8 Residence">Novo 8 Residence</option>
                <option value="Century Mahkota">Century Mahkota</option>
                <option value="Wave Residence">Wave Residence</option>
                <option value="Quartz Residence">Quartz Residence</option>
                <option value="Atlantis Residence">Atlantis Residence</option>
                <option value="Other">å…¶ä»– / ä¸ç¡®å®š</option>
              </select>
            </div>

            <!-- Interest -->
            <div>
              <label for="interest" class="block text-sm font-semibold text-gray-700 mb-2">
                æˆ‘æ„Ÿå…´è¶£çš„æ˜¯...
              </label>
              <select
                id="interest"
                name="interest"
                class="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:border-green-500 focus:outline-none transition-colors"
              >
                <option value="">é€‰æ‹©æ‚¨çš„å…´è¶£</option>
                <option value="New Investment">è´­ä¹°æˆ¿äº§åšAirbnb</option>
                <option value="Conversion">å°†ç°æœ‰æˆ¿äº§è½¬æ¢ä¸ºAirbnb</option>
                <option value="Management">è½¬ç”¨ä¸“ä¸šç®¡ç†</option>
                <option value="Pricing">ä»·æ ¼ä¿¡æ¯</option>
                <option value="Other">å…¶ä»–å’¨è¯¢</option>
              </select>
            </div>

            <!-- Message -->
            <div>
              <label for="message" class="block text-sm font-semibold text-gray-700 mb-2">
                æ‚¨çš„æ¶ˆæ¯ï¼ˆå¯é€‰ï¼‰
              </label>
              <textarea
                id="message"
                name="message"
                rows="4"
                class="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:border-green-500 focus:outline-none transition-colors"
                placeholder="å‘Šè¯‰æˆ‘ä»¬å…³äºæ‚¨çš„æˆ¿äº§æˆ–è¯¢é—®ä»»ä½•äº‹æƒ…..."
              ></textarea>
            </div>

            <!-- Hidden fields for tracking -->
            <input type="hidden" name="referrer" value={referrer} />
            <input type="hidden" name="utm_source" value={utmSource} />
            <input type="hidden" name="utm_campaign" value={utmCampaign} />

            <!-- Submit Button -->
            <button
              type="submit"
              class="w-full bg-green-600 hover:bg-green-700 text-white font-bold py-4 rounded-xl text-lg transition-colors shadow-lg"
            >
              é€šè¿‡WhatsAppå‘é€
            </button>

            <p class="text-center text-sm text-gray-500 mt-4">
              æˆ‘ä»¬ç»ä¸ä¼šç»™æ‚¨å‘é€åƒåœ¾é‚®ä»¶ã€‚æ‰¿è¯ºã€‚
            </p>
          </form>
        </div>
      </div>
    </section>

    <!-- What Happens Next -->
    <section class="py-16 bg-gray-50">
      <div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8">
        <h2 class="text-3xl font-bold text-gray-900 mb-8 text-center">
          æ¥ä¸‹æ¥ä¼šå‘ç”Ÿä»€ä¹ˆï¼Ÿ
        </h2>

        <div class="grid md:grid-cols-3 gap-8">
          <div class="bg-white p-6 rounded-xl shadow-sm text-center">
            <div class="w-12 h-12 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-4">
              <span class="text-2xl">ğŸ“</span>
            </div>
            <h3 class="font-bold text-gray-900 mb-2">1. æ‚¨æäº¤è¡¨æ ¼</h3>
            <p class="text-gray-600 text-sm">å¡«å†™æ‚¨çš„è¯¦ç»†ä¿¡æ¯ï¼Œæˆ‘ä»¬å°†ç«‹å³å‡†å¤‡ä¸ªæ€§åŒ–å›å¤ã€‚</p>
          </div>

          <div class="bg-white p-6 rounded-xl shadow-sm text-center">
            <div class="w-12 h-12 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-4">
              <span class="text-2xl">ğŸ’¬</span>
            </div>
            <h3 class="font-bold text-gray-900 mb-2">2. æˆ‘ä»¬WhatsAppæ‚¨</h3>
            <p class="text-gray-600 text-sm">åœ¨24å°æ—¶å†…ï¼Œæ‚¨å°†æ”¶åˆ°ä¸ªæ€§åŒ–çš„WhatsAppæ¶ˆæ¯ã€‚</p>
          </div>

          <div class="bg-white p-6 rounded-xl shadow-sm text-center">
            <div class="w-12 h-12 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-4">
              <span class="text-2xl">ğŸ“</span>
            </div>
            <h3 class="font-bold text-gray-900 mb-2">3. å…è´¹å’¨è¯¢</h3>
            <p class="text-gray-600 text-sm">æˆ‘ä»¬å°†è®¨è®ºæ‚¨çš„æˆ¿äº§ï¼Œå›ç­”é—®é¢˜ï¼Œå¹¶æä¾›ä¸“å®¶å»ºè®®ã€‚</p>
          </div>
        </div>
      </div>
    </section>

    <!-- FAQ -->
    <section class="py-16 bg-white">
      <div class="max-w-3xl mx-auto px-4 sm:px-6 lg:px-8">
        <h2 class="text-3xl font-bold text-gray-900 mb-8 text-center">
          å¸¸è§é—®é¢˜
        </h2>

        <div class="space-y-4">
          <details class="bg-gray-50 p-6 rounded-xl">
            <summary class="font-bold text-gray-900 cursor-pointer">æ‚¨å›å¤æœ‰å¤šå¿«ï¼Ÿ</summary>
            <p class="mt-3 text-gray-600">æˆ‘ä»¬é€šå¸¸åœ¨24å°æ—¶å†…å›å¤ï¼Œå·¥ä½œæ—¶é—´é€šå¸¸æ›´å¿«ã€‚</p>
          </details>

          <details class="bg-gray-50 p-6 rounded-xl">
            <summary class="font-bold text-gray-900 cursor-pointer">å’¨è¯¢æ”¶è´¹å—ï¼Ÿ</summary>
            <p class="mt-3 text-gray-600">ä¸ï¼Œå’¨è¯¢å®Œå…¨å…è´¹ã€‚æˆ‘ä»¬ä¼šè®¿é—®æ‚¨çš„æˆ¿äº§ï¼Œè¯„ä¼°å…¶æ½œåŠ›ï¼Œå¹¶ç»™å‡ºè¯šå®å»ºè®® - æ— ä¹‰åŠ¡ã€‚</p>
          </details>

          <details class="bg-gray-50 p-6 rounded-xl">
            <summary class="font-bold text-gray-900 cursor-pointer">æˆ‘åº”è¯¥å‡†å¤‡ä»€ä¹ˆä¿¡æ¯ï¼Ÿ</summary>
            <p class="mt-3 text-gray-600">åªéœ€å‡†å¤‡å¥½æ‚¨çš„æˆ¿äº§ä½ç½®å’ŒåŸºæœ¬ä¿¡æ¯å³å¯ã€‚åœ¨æˆ‘ä»¬çš„WhatsAppå¯¹è¯ä¸­ï¼Œæˆ‘ä»¬ä¼šå¼•å¯¼æ‚¨å®Œæˆå…¶ä»–æ‰€æœ‰äº‹é¡¹ã€‚</p>
          </details>
        </div>
      </div>
    </section>
  </main>

  <script is:inline>
    document.getElementById('contact-form').addEventListener('submit', function(e) {
      e.preventDefault();

      const name = document.getElementById('name').value;
      const phone = document.getElementById('phone').value;
      const email = document.getElementById('email').value;
      const property = document.getElementById('property').value;
      const interest = document.getElementById('interest').value;
      const message = document.getElementById('message').value;
      const referrer = document.querySelector('input[name="referrer"]').value;

      // Build WhatsApp message with context
      let whatsappMessage = `æ‚¨å¥½iHousingï¼æˆ‘æƒ³å’¨è¯¢ä½ ä»¬çš„Airbnbç®¡ç†æœåŠ¡ã€‚\n\n`;
      whatsappMessage += `*å§“åï¼š* ${name}\n`;
      whatsappMessage += `*ç”µè¯ï¼š* ${phone}\n`;

      if (email) {
        whatsappMessage += `*é‚®ç®±ï¼š* ${email}\n`;
      }

      if (property && property !== 'Other') {
        whatsappMessage += `*æˆ¿äº§ï¼š* ${property}\n`;
      }

      if (interest) {
        whatsappMessage += `*å…´è¶£ï¼š* ${interest}\n`;
      }

      if (message) {
        whatsappMessage += `\n*æ¶ˆæ¯ï¼š*\n${message}\n`;
      }

      // Add referrer context for tracking
      if (referrer && referrer !== window.location.href) {
        try {
          const referrerUrl = new URL(referrer);
          const referrerPath = referrerUrl.pathname;
          whatsappMessage += `\n*æ¥è‡ªï¼š* ${referrerPath}`;
        } catch (e) {
          // Invalid URL, skip
        }
      }

      const encodedMessage = encodeURIComponent(whatsappMessage);
      const whatsappUrl = `https://wa.me/60196996688?text=${encodedMessage}`;

      // Redirect to WhatsApp
      window.open(whatsappUrl, '_blank');
    });
  </script>
</Layout>
